<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="e_design.Many2ManyImage">
        <div t-attf-class="oe_fileupload {{props.className ? props.className : ''}}" aria-atomic="true">
            <div class="row align-items-center mb-3">
                <div class="col-auto">
                    <div t-if="!props.readonly &amp;&amp; (!props.numberOfFiles or files.length &lt; props.numberOfFiles)" 
                         class="oe_add">
                        <FileInput
                            acceptedFileExtensions="props.acceptedFileExtensions"
                            multiUpload="true"
                            onUpload.bind="onFileUploaded"
                            resModel="props.record.resModel"
                            resId="props.record.resId or 0"
                        >
                            <button class="m-2 btn btn-secondary o_attach" data-tooltip="Attach">
                                <span class="fa fa-paperclip" aria-label="Attach"/> <t t-esc="uploadText"/>
                            </button>
                        </FileInput>
                    </div>
                </div>
                <div class="col">
                    <small class="text-muted fst-italic" t-if="files.length > 0">
                        Click on any image to view full size. You can upload up to <t t-esc="props.numberOfFiles"/> files.
                    </small>
                </div>
            </div>
            
            <div class="row g-3 many2many_image-style">
                <t t-if="files.length > 0">
                    <t t-foreach="files" t-as="file" t-key="file.id">
                        <t t-call="e_design.Many2ManyImage.attachment_preview"/>
                    </t>
                </t>
                <div t-else="" class="text-muted fst-italic p-2">
                    No data uploaded
                </div>
            </div>
        </div>
    </t>

    <t t-name="e_design.Many2ManyImage.attachment_preview">
        <t t-set="editable" t-value="!props.readonly"/>
        <t t-set="ext" t-value="getExtension(file)"/>
        <t t-set="url" t-value="getUrl(file.id)"/>
        <t t-set="isImage" t-value="isImageFile(file)"/>
        
        <div class="col-auto">
            <div t-attf-class="card card-widget h-100 #{editable ? 'o_attachment_editable' : ''} #{upload ? 'o_attachment_uploading' : ''} #{!isImage ? 'o_file_non_image' : ''}">
                
                <div class="position-relative">
                    <a t-if="isImage" t-att-href="url" aria-label="View" data-fancybox="gallery">
                        <img class="card-img-top" t-att-src="url" t-att-alt="file.name"/>
                    </a>
                    
                    
                    <div t-else="" class="file-format-placeholder bg-primary" t-att-data-extension="ext.toUpperCase()">
                        <div class="file-format-content">
                            <span class="file-format-text">
                                .<t t-esc="ext.toUpperCase()"/>
                            </span>
                        </div>
                    </div>
                    
                    <div t-if="editable" class="position-absolute top-0 end-0 m-2">
                        <div class="btn-group btn-group-sm">
                            <a t-att-href="url" class="btn btn-light" download="" 
                               t-att-data-tooltip="'Download ' + file.name">
                                <i class="fa fa-download"/>
                            </a>
                            <button class="btn btn-danger" t-on-click.stop="() => this.onFileRemove(file.id)"
                                    t-att-data-tooltip="'Delete ' + file.name">
                                <i class="fa fa-trash"/>
                            </button>
                        </div>
                    </div>
                    
                    <div t-if="upload" class="position-absolute top-50 start-50 translate-middle">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Uploading...</span>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0 text-truncate" t-att-title="file.name" t-esc="file.name"/>
                        <small class="ms-2 text-muted text-uppercase" t-esc="ext"/>
                    </div>
                </div>
            </div>
        </div>
    </t>

</templates>